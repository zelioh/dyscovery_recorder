$(document).ready(()=>{$.ajax({type:"POST",url:"words",context:this,success:function(r){m(r);}});function m(l){var i=0;var k=window.AudioContext||window.webkitAudioContext;var d=FormData;var j=Recorder;var a;var g;var p;var r;$('#record-button').click(()=>{let c=$('#mic').attr('src');if(c=='asset/white_mic.png'){let w={audio:true,video:false};navigator.mediaDevices.getUserMedia(w).then(function(s){a=new k();g=s;p=a.createMediaStreamSource(s);r=new j(p,{numChannels:2});r.record();$('#mic').attr('src','asset/white_square.png');}).catch(function(e){console.log(e);});}else{r.stop();g.getAudioTracks()[0].stop();r.exportWAV(e);}});function x(o) {var r='';let c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let s=c.length;for(let q=0;q<o;q++){r+=c.charAt(Math.floor(Math.random()*s));}return r;}function e(b){let c=$('#word').html();if(!l.includes(c)){alert('Erreur, le mot n\'existe pas');return;}c+='_'+x(15)+'.wav';var f=new d();f.append("audio",b,c);$.ajax({type:"POST",url: "save",data:f,contentType:false,processData:false,cache:false,enctype: 'multipart/form-data',success:function(r){$('#mic').attr('src','asset/white_mic.png');$('#word').html(l[++i]);if(i>=l.length){window.location.href = "end";}}});}$('#word').html(l[i]);}});